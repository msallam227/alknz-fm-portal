# ALKNZ Portal — Render Deployment Guide

## Architecture on Render

```
Browser → https://alknz-web.onrender.com  (Static Site)
              │
              │  REACT_APP_BACKEND_URL
              ▼
          https://alknz-api.onrender.com  (Web Service, Docker)
              │
              ▼
          MongoDB Atlas
```

- `alknz-web` → React app served as a Static Site (free CDN)
- `alknz-api` → FastAPI in Docker (Web Service)
- CORS is pre-configured to `*` — no cross-domain issues

> **Local dev**: `docker-compose.yml` still works as before (nginx proxy on port 3000).
> Render uses `render.yaml` instead — two separate services.

---

## Deploy Steps

1. Push repo to GitHub
2. Render → **New → Blueprint**
3. Connect your GitHub repo
4. **Blueprint Path** → `render.yaml` (default, leave blank)
5. Add all environment variables below
6. Click **Apply** — Render builds both services

---

## Environment Variables

Set these in the Render dashboard (both services):

### alknz-api (backend)

| Variable | Value |
|---|---|
| `MONGO_URL` | Your MongoDB Atlas connection string (see below) |
| `DB_NAME` | `alknz_db` |
| `JWT_SECRET` | Auto-generated by Render (`generateValue: true`) |
| `ANTHROPIC_API_KEY` | Your Anthropic API key |
| `GOOGLE_CLIENT_ID` | Your Google OAuth client ID |
| `GOOGLE_CLIENT_SECRET` | Your Google OAuth client secret |
| `GOOGLE_REDIRECT_URI` | `https://alknz-api.onrender.com/auth/google/callback` |

### alknz-web (frontend) — set AFTER first backend deploy

| Variable | Value |
|---|---|
| `REACT_APP_BACKEND_URL` | `https://alknz-api.onrender.com` (your actual backend URL) |

> After setting `REACT_APP_BACKEND_URL`, trigger a manual redeploy of `alknz-web`
> so the frontend rebuilds with the correct backend URL baked in.

---

## MongoDB Atlas — MONGO_URL

Format:
```
mongodb+srv://<username>:<password>@<cluster>.mongodb.net/?retryWrites=true&w=majority
```

Steps to get it:
1. Go to [cloud.mongodb.com](https://cloud.mongodb.com)
2. Your cluster → **Connect → Drivers**
3. Copy the connection string
4. Replace `<password>` with your Atlas password
5. **Important:** In Atlas → Network Access → Add `0.0.0.0/0` so Render can connect

---

## After Deploying — Seed Demo Data

Run once to populate demo accounts and investor data.

**Option A — Run locally against Atlas:**
```bash
MONGO_URL="mongodb+srv://..." DB_NAME=alknz_db python3 backend/seed_demo.py
```

**Option B — Render Shell (alknz-api service → Shell tab):**
```bash
python3 seed_demo.py
```

### Demo Credentials

| Role | Email | Password |
|---|---|---|
| Admin | `admin@demo.alknz.io` | `Demo@Admin1` |
| Fund Manager | `sara@demo.alknz.io` | `Demo@FM2024` |

Sara's account: 12 GCC investors · 26 tasks · 2 personas · 4 call logs · 4 email templates

---

## Update Docs Site URL

Once deployed, replace `YOUR_PORTAL_URL` in the docs site with your live frontend URL:

```bash
# macOS
grep -rl "YOUR_PORTAL_URL" alknz-portal-docs/ | xargs sed -i '' 's|YOUR_PORTAL_URL|https://alknz-web.onrender.com|g'
```

---

## Key Files

| File | Purpose |
|---|---|
| `render.yaml` | Render Blueprint — defines both services |
| `docker-compose.yml` | Local development only (nginx proxy on port 3000) |
| `backend/Dockerfile` | FastAPI on port 8001 |
| `frontend/Dockerfile` | React build + nginx (used for local docker only) |
| `frontend/nginx.conf` | nginx config (local docker only) |
| `backend/seed_demo.py` | Demo data seed script |
| `alknz-portal-docs/` | Static documentation site |
